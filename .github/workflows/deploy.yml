# Enable WinRM
Enable-PSRemoting -Force

# Configure WinRM for HTTPS
$cert = New-SelfSignedCertificate -DnsName $env:COMPUTERNAME -CertStoreLocation Cert:\LocalMachine\My
New-Item -Path WSMan:\LocalHost\Listener -Transport HTTPS -Address * -CertificateThumbPrint $cert.Thumbprint -Force

# Configure WinRM for HTTP (fallback)
Enable-PSRemoting -Force -SkipNetworkProfileCheck

# Set authentication
Set-Item -Path WSMan:\LocalHost\Service\Auth\Basic -Value $true
Set-Item -Path WSMan:\LocalHost\Service\AllowUnencrypted -Value $true

# Configure firewall
netsh advfirewall firewall add rule name="WinRM HTTPS" dir=in action=allow protocol=TCP localport=5986
netsh advfirewall firewall add rule name="WinRM HTTP" dir=in action=allow protocol=TCP localport=5985

# Restart service
Restart-Service WinRM

# Verify configuration
Get-Service WinRM
Test-WSMan
